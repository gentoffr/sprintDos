import{a as me}from"./chunk-57XFV6CK.js";import{a as fe}from"./chunk-3WFIUOOG.js";import{a as le,c as de,e as ge,j as ue,l as he}from"./chunk-ZZLYJSMT.js";import{a as O,b as k}from"./chunk-E62EBHYI.js";import{$ as J,A as l,E as c,F as a,G as s,H as C,K as R,L as _,M as g,N as W,O as H,P as Y,Q as K,R as j,S as p,T as w,U as M,W as Q,X as q,Y as G,a as B,aa as S,ba as X,c as z,ca as Z,da as ee,i as F,ja as te,ka as y,l as $,la as P,m as u,ma as ne,n as h,na as oe,o as L,oa as v,pa as ie,ra as re,s as U,sa as ae,t as r,ta as se,v as m,va as ce,w as b,wa as pe}from"./chunk-RPINSWGJ.js";import"./chunk-LJ5XHLMQ.js";import{a as V,b as N,h as f}from"./chunk-FK42CRUA.js";var ve=(o,e)=>["toast-item",o,e];function xe(o,e){if(o&1&&(a(0,"div",2),p(1),s()),o&2){let t=e.$implicit;c("ngClass",J(2,ve,t.type,t.state)),r(),M(" ",t.message," ")}}var T=class o{constructor(e){this.toastService=e}toasts=[];subscription=new B;ngOnInit(){this.subscription=this.toastService.toast$.subscribe(e=>{this.showToast(e)})}ngOnDestroy(){this.subscription.unsubscribe()}showToast(e){let t=N(V({},e),{state:"enter"});this.toasts.push(t);let n=e.duration??3e3;setTimeout(()=>{t.state="exit",setTimeout(()=>{this.toasts=this.toasts.filter(i=>i!==t)},300)},n)}static \u0275fac=function(t){return new(t||o)(m(me))};static \u0275cmp=b({type:o,selectors:[["app-toast"]],decls:2,vars:1,consts:[[1,"toast-container"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(t,n){t&1&&(a(0,"div",0),l(1,xe,2,5,"div",1),s()),t&2&&(r(),c("ngForOf",n.toasts))},dependencies:[v,te,y],styles:[".toast-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:9999}.toast-item[_ngcontent-%COMP%]{padding:12px 18px;border-radius:6px;min-width:200px;color:#fff;font-weight:500;box-shadow:0 4px 8px #0003}.toast-item.success[_ngcontent-%COMP%]{background-color:#4caf50}.toast-item.error[_ngcontent-%COMP%]{background-color:#f44336}.toast-item.info[_ngcontent-%COMP%]{background-color:#2196f3}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}@keyframes _ngcontent-%COMP%_slideOut{0%{transform:translate(0);opacity:1}to{transform:translate(120%);opacity:0}}.toast-item.enter[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn .3s forwards}.toast-item.exit[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideOut .3s forwards}"]})};var I=class o{constructor(e){this.supabaseService=e;this.loadMessages(),this.subscribeToMessages()}messagesSubject=new z([]);messages$=this.messagesSubject.asObservable();channel;loadMessages(){return f(this,null,function*(){try{let{data:e,error:t}=yield this.supabaseService.supabase.from("chat_messages").select("*").order("created_at",{ascending:!0});if(t)throw t;return this.messagesSubject.next(e||[]),e}catch(e){throw console.error("Error cargando mensajes:",e),e}})}sendMessage(e,t){return f(this,null,function*(){try{let{data:n,error:i}=yield this.supabaseService.supabase.from("chat_messages").insert([{content:e.trim(),user_email:t}]).select();if(i)throw i;return n}catch(n){throw console.error("Error enviando mensaje:",n),n}})}subscribeToMessages(){this.channel=this.supabaseService.supabase.channel("chat_messages_realtime",{config:{broadcast:{self:!1}}}).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages"},e=>{console.log("Nuevo mensaje detectado:",e);let t=e.new,n=this.messagesSubject.value;this.messagesSubject.next([...n,t])}).on("postgres_changes",{event:"DELETE",schema:"public",table:"chat_messages"},e=>{console.log("Mensaje eliminado:",e);let t=e.old,i=this.messagesSubject.value.filter(d=>d.id!==t.id);this.messagesSubject.next(i)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"chat_messages"},e=>{console.log("Mensaje actualizado:",e);let t=e.new,i=this.messagesSubject.value.map(d=>d.id===t.id?t:d);this.messagesSubject.next(i)}).subscribe(e=>{console.log("Estado del canal de tiempo real:",e),e==="SUBSCRIBED"?console.log("\u2705 Chat en tiempo real conectado exitosamente"):e==="CHANNEL_ERROR"&&(console.error("\u274C Error en la conexi\xF3n de tiempo real"),setTimeout(()=>this.reconnectRealtime(),5e3))})}reconnectRealtime(){console.log("\u{1F504} Intentando reconectar tiempo real..."),this.unsubscribe(),this.subscribeToMessages()}unsubscribe(){this.channel&&(this.supabaseService.supabase.removeChannel(this.channel),this.channel=null)}getConnectionStatus(){return this.channel?.state||"disconnected"}forceReconnect(){this.reconnectRealtime()}static \u0275fac=function(t){return new(t||o)($(O))};static \u0275prov=F({token:o,factory:o.\u0275fac,providedIn:"root"})};var ye=["chatMessages"];function Pe(o,e){if(o&1&&C(0,"img",21),o&2){let t=g().$implicit,n=g();c("src",n.getBanderaPais(t.user_email),U)}}function Oe(o,e){if(o&1&&(a(0,"span",22),p(1),s()),o&2){let t=g().$implicit,n=g();r(),M("(",n.getNombrePais(t.user_email),")")}}function ke(o,e){if(o&1&&(a(0,"div",14)(1,"div",15)(2,"span",16),l(3,Pe,1,1,"img",17),p(4),l(5,Oe,2,1,"span",18),s(),a(6,"span",19),p(7),S(8,"date"),s()(),a(9,"div",20),p(10),s()()),o&2){let t=e.$implicit,n=g();j("own-message",t.user_email===(n.user==null?null:n.user.email)),r(3),c("ngIf",n.getBanderaPais(t.user_email)),r(),M(" ",t.user_email," "),r(),c("ngIf",n.getNombrePais(t.user_email)),r(2),w(Z(8,7,t.created_at,"short")),r(3),w(t.content)}}function Te(o,e){o&1&&(a(0,"div",23),p(1," No hay mensajes a\xFAn. \xA1S\xE9 el primero en escribir algo! \u{1F3AE} "),s())}function Ie(o,e){if(o&1){let t=R();a(0,"div",24)(1,"button",25),_("click",function(){u(t);let i=g();return h(i.toggleChat())}),p(2," \u{1F4AC} Abrir Chat "),s()()}}var E=class o{constructor(e,t,n,i){this.chatService=e;this.supabaseService=t;this.authService=n;this.paisService=i;this.paises=this.paisService.getPaises()}chatMessagesContainer;user=null;messages=[];newMessage="";subscriptions=[];isChatVisible=!1;connectionStatus="connecting";paises=[];usuariosPais={};shouldScrollToBottom=!1;ngOnInit(){let e=this.chatService.messages$.subscribe(t=>{let n=this.messages.length;this.messages=t,t.length>n&&(this.shouldScrollToBottom=!0)});this.subscriptions.push(e),this.loadUsuariosPais(),setInterval(()=>{this.connectionStatus=this.chatService.getConnectionStatus()},2e3)}ngAfterViewChecked(){this.shouldScrollToBottom&&(this.scrollToBottom(),this.shouldScrollToBottom=!1)}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.chatService.unsubscribe()}toggleChat(){this.isChatVisible=!this.isChatVisible,this.isChatVisible&&setTimeout(()=>this.scrollToBottom(),100)}scrollToBottom(){try{if(this.chatMessagesContainer){let e=this.chatMessagesContainer.nativeElement;e.scrollTop=e.scrollHeight}}catch(e){console.log("Error al hacer scroll:",e)}}sendMessage(){return f(this,null,function*(){if(this.newMessage.trim()){if(!this.user?.email){alert("Debes iniciar sesi\xF3n para enviar mensajes en el chat");return}try{yield this.chatService.sendMessage(this.newMessage,this.user.email),this.newMessage="",this.shouldScrollToBottom=!0}catch(e){console.error("Error enviando mensaje:",e),alert("Error enviando mensaje. Intenta de nuevo.")}}})}onKeyPress(e){e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),this.sendMessage())}forceReconnect(){this.chatService.forceReconnect(),this.connectionStatus="reconnecting"}getConnectionIndicator(){switch(this.connectionStatus){case"SUBSCRIBED":return"\u{1F7E2}";case"CHANNEL_ERROR":return"\u{1F534}";case"connecting":return"\u{1F7E1}";case"reconnecting":return"\u{1F7E1}";default:return"\u26AB"}}trackByMessageId(e,t){return t.id||e}getBanderaPais(e){let t=this.usuariosPais[e];return t?`https://flagcdn.com/24x18/${t}.png`:null}getNombrePais(e){let t=this.usuariosPais[e];if(!t)return null;let n=this.paises.find(i=>i.codigo===t);return n?n.nombre:null}loadUsuariosPais(){return f(this,null,function*(){try{let e=yield this.supabaseService.getUsers();this.usuariosPais={};for(let t of e)this.usuariosPais[t.email]=t.pais}catch{this.usuariosPais={}}})}static \u0275fac=function(t){return new(t||o)(m(I),m(O),m(k),m(fe))};static \u0275cmp=b({type:o,selectors:[["app-chat"]],viewQuery:function(t,n){if(t&1&&W(ye,5),t&2){let i;H(i=Y())&&(n.chatMessagesContainer=i.first)}},inputs:{user:"user"},decls:20,vars:9,consts:[["chatMessages",""],[1,"chat-panel"],[1,"chat-header"],[1,"connection-status"],[3,"title"],["title","Reconectar",1,"reconnect-btn",3,"click"],[1,"close-btn",3,"click"],[1,"chat-messages"],["class","message",3,"own-message",4,"ngFor","ngForOf","ngForTrackBy"],["class","no-messages",4,"ngIf"],[1,"chat-input"],["type","text","placeholder","Escribe tu mensaje...","maxlength","500",1,"message-input",3,"ngModelChange","keypress","ngModel"],[1,"send-btn",3,"click"],["class","chat-closed-indicator",4,"ngIf"],[1,"message"],[1,"message-header"],[1,"user"],["width","20","height","15","style","vertical-align: middle; margin-right: 4px; border-radius:2px;",3,"src",4,"ngIf"],["class","pais-nombre",4,"ngIf"],[1,"time"],[1,"message-content"],["width","20","height","15",2,"vertical-align","middle","margin-right","4px","border-radius","2px",3,"src"],[1,"pais-nombre"],[1,"no-messages"],[1,"chat-closed-indicator"],[1,"chat-indicator-btn",3,"click"]],template:function(t,n){if(t&1){let i=R();a(0,"div",1)(1,"div",2)(2,"h3"),p(3,"\u{1F4AC} Chat General"),s(),a(4,"div",3)(5,"span",4),p(6),s(),a(7,"button",5),_("click",function(){return u(i),h(n.forceReconnect())}),p(8,"\u{1F504}"),s()(),a(9,"button",6),_("click",function(){return u(i),h(n.toggleChat())}),p(10,"\u2716"),s()(),a(11,"div",7,0),l(13,ke,11,10,"div",8)(14,Te,2,0,"div",9),s(),a(15,"div",10)(16,"input",11),G("ngModelChange",function(x){return u(i),q(n.newMessage,x)||(n.newMessage=x),h(x)}),_("keypress",function(x){return u(i),h(n.onKeyPress(x))}),s(),a(17,"button",12),_("click",function(){return u(i),h(n.sendMessage())}),p(18," ENVIAR "),s()()(),l(19,Ie,3,0,"div",13)}t&2&&(j("visible",n.isChatVisible),r(5),c("title",n.connectionStatus),r(),w(n.getConnectionIndicator()),r(7),c("ngForOf",n.messages)("ngForTrackBy",n.trackByMessageId),r(),c("ngIf",n.messages.length===0),r(2),Q("ngModel",n.newMessage),r(3),c("ngIf",!n.isChatVisible))},dependencies:[v,y,P,he,le,de,ue,ge,oe],styles:[".navbar[_ngcontent-%COMP%]{width:100vw;margin:0;box-sizing:border-box;display:flex;justify-content:space-between;align-items:center;background-color:#1e293b;color:#fff;padding:1rem 2rem;box-shadow:0 2px 4px #0003}.logo[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700}.nav-links[_ngcontent-%COMP%]{list-style:none;justify-content:center;align-items:center;display:flex;gap:1.5rem;margin:0;padding:0}.nav-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;font-weight:500;transition:opacity .2s}.nav-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{opacity:.7}.container[_ngcontent-%COMP%]{max-width:1000px;margin:2rem auto;padding:0 1rem;text-align:center}.game-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1.5rem;margin-top:2rem}.game-card[_ngcontent-%COMP%]{background:#f8fafc;border:2px solid #e2e8f0;border-radius:1rem;padding:2rem 1rem;cursor:pointer;box-shadow:0 2px 6px #0000001a;transition:transform .2s,box-shadow .2s}.game-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 4px 12px #00000026}.game-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.3rem;color:#1e293b}button[type=button][_ngcontent-%COMP%]:hover{background:linear-gradient(90deg,#3aa392 60%,#1a997d);transform:translateY(-2px) scale(1.03)}button[type=button][_ngcontent-%COMP%]{margin-top:.5rem;padding:.8rem;background:#a50505;color:#fff;border:none;border-radius:8px;font-size:1.1rem;font-weight:600;cursor:pointer;box-shadow:0 2px 8px #5e6fff14;transition:background .2s,transform .1s}.chat-toggle-btn[_ngcontent-%COMP%]{background:#3b82f6!important;font-size:1rem!important;padding:.8rem 1.2rem!important;font-weight:700!important;border:2px solid #2563eb!important;box-shadow:0 4px 8px #3b82f64d!important}.chat-toggle-btn[_ngcontent-%COMP%]:hover{background:#2563eb!important;transform:translateY(-2px) scale(1.05)!important;box-shadow:0 6px 12px #3b82f666!important}.chat-panel[_ngcontent-%COMP%]{position:fixed;right:-400px;top:80px;width:350px;height:calc(100vh - 100px);background:#fff;border:1px solid #e2e8f0;border-radius:1rem 0 0 1rem;box-shadow:-4px 0 12px #00000026;display:flex;flex-direction:column;transition:right .3s ease-in-out;z-index:1000}.chat-panel.visible[_ngcontent-%COMP%]{right:0}.chat-header[_ngcontent-%COMP%]{background:#1e293b;color:#fff;padding:1rem;display:flex;justify-content:space-between;align-items:center;border-radius:1rem 0 0}.chat-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem}.connection-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.reconnect-btn[_ngcontent-%COMP%]{background:none!important;border:none!important;color:#fff!important;font-size:.9rem!important;cursor:pointer;padding:.2rem!important;margin:0!important;border-radius:4px;opacity:.7;transition:opacity .2s}.reconnect-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a!important;opacity:1;transform:none!important}.close-btn[_ngcontent-%COMP%]{background:none!important;border:none!important;color:#fff!important;font-size:1.2rem!important;cursor:pointer;padding:.2rem!important;margin:0!important;border-radius:4px}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a!important;transform:none!important}.chat-messages[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1rem;display:flex;flex-direction:column;gap:.8rem;scroll-behavior:smooth}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f5f9;border-radius:4px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:4px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.message[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:.8rem;padding:.8rem;max-width:85%;align-self:flex-start}.message.own-message[_ngcontent-%COMP%]{background:#dbeafe;border-color:#3b82f6;align-self:flex-end}.message-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.4rem;font-size:.8rem}.user[_ngcontent-%COMP%]{font-weight:600;color:#1e293b}.time[_ngcontent-%COMP%]{color:#64748b}.message-content[_ngcontent-%COMP%]{font-size:.9rem;line-height:1.4;color:#374151;word-wrap:break-word}.no-messages[_ngcontent-%COMP%]{text-align:center;color:#64748b;font-style:italic;margin-top:2rem}.chat-input[_ngcontent-%COMP%]{padding:1rem;border-top:1px solid #e2e8f0;display:flex;gap:.5rem;align-items:center;background:#f8fafc;min-height:60px}.message-input[_ngcontent-%COMP%]{flex:1;padding:.8rem;border:1px solid #e2e8f0;border-radius:8px;font-size:.9rem;outline:none;transition:border-color .2s}.message-input[_ngcontent-%COMP%]:focus{border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.send-btn[_ngcontent-%COMP%]{background:#dc2626!important;padding:.8rem 1.5rem!important;font-size:1rem!important;font-weight:700!important;border:2px solid #b91c1c!important;border-radius:8px!important;margin:0!important;transition:all .2s!important;color:#fff!important;cursor:pointer!important;min-width:80px!important}.send-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#b91c1c!important;transform:translateY(-1px) scale(1.05)!important;box-shadow:0 4px 8px #dc26264d!important}.send-btn[_ngcontent-%COMP%]:disabled{background:#9ca3af!important;cursor:not-allowed!important;transform:none!important}.chat-closed-indicator[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;z-index:1000}.chat-indicator-btn[_ngcontent-%COMP%]{background:#3b82f6!important;color:#fff!important;border:none!important;padding:1rem 1.5rem!important;border-radius:50px!important;font-size:1rem!important;font-weight:700!important;box-shadow:0 4px 12px #3b82f64d!important;cursor:pointer!important;margin:0!important;transition:all .3s!important}.chat-indicator-btn[_ngcontent-%COMP%]:hover{background:#2563eb!important;transform:scale(1.1)!important;box-shadow:0 6px 20px #3b82f666!important}.login-warning[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e;text-align:center;padding:.8rem;font-size:.9rem;border-top:1px solid #f3ca20}.message-input[_ngcontent-%COMP%]:disabled{background:#f3f4f6!important;cursor:not-allowed!important;opacity:.6}.test-btn[_ngcontent-%COMP%]{background:#f59e0b!important;padding:.8rem 1rem!important;font-size:.8rem!important;border-radius:8px!important;margin:0!important;transition:all .2s!important}.test-btn[_ngcontent-%COMP%]:hover{background:#d97706!important;transform:translateY(-1px)!important}@media (max-width: 768px){.chat-panel[_ngcontent-%COMP%]{width:100vw;right:-100vw;top:70px;border-radius:0}.chat-header[_ngcontent-%COMP%]{border-radius:0}}"]})};function Ee(o,e){if(o&1&&C(0,"app-chat",2),o&2){let t=e.ngIf,n=g();c("user",t)("hidden",n.currentRoute==="/login"||n.currentRoute==="/registro")}}function De(o,e){}var D=class o{constructor(e,t){this.authService=e;this.router=t;this.user$=this.authService.user$,this.router.events.subscribe(()=>{this.currentRoute=this.router.url}),this.currentRoute=this.router.url}title=L("sprintDos");user$;currentRoute="";showChat(){return this.currentRoute!=="/login"&&this.currentRoute!=="/registro"}static \u0275fac=function(t){return new(t||o)(m(k),m(se))};static \u0275cmp=b({type:o,selectors:[["app-root"]],decls:6,vars:4,consts:[["noChat",""],[3,"user","hidden",4,"ngIf","ngIfElse"],[3,"user","hidden"]],template:function(t,n){if(t&1&&(C(0,"app-toast"),l(1,Ee,1,2,"app-chat",1),S(2,"async"),l(3,De,0,0,"ng-template",null,0,ee),C(5,"router-outlet")),t&2){let i=K(4);r(),c("ngIf",X(2,2,n.user$))("ngIfElse",i)}},dependencies:[ae,v,P,T,E,ne],encapsulation:2})};var _e=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",loadComponent:()=>import("./chunk-TN2MV5VQ.js").then(o=>o.Login)},{path:"home",loadComponent:()=>import("./chunk-GODU6YQY.js").then(o=>o.Home)},{path:"registro",loadComponent:()=>import("./chunk-R3DZCCFR.js").then(o=>o.RegistroComponent)},{path:"ahorcado",loadComponent:()=>import("./chunk-3JPX37YQ.js").then(o=>o.AhorcadoComponent)},{path:"hi-lo",loadComponent:()=>import("./chunk-D24QD4TZ.js").then(o=>o.MayorOMenorComponent)},{path:"preguntados",loadComponent:()=>import("./chunk-J6FCIV5J.js").then(o=>o.PreguntadosComponent)},{path:"Coinflip",loadComponent:()=>import("./chunk-G23UH5TY.js").then(o=>o.CoinflipComponent)}];ie(D,{providers:[ce(_e,pe()),re()]});
