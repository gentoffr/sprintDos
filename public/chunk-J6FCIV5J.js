import{a as j,b as T}from"./chunk-E62EBHYI.js";import{$ as S,A as h,E as l,F as a,G as s,K as k,L as g,M as m,S as d,T as x,U as v,V as w,i as P,ja as y,ka as I,l as _,la as N,m as C,n as M,o as c,oa as E,qa as D,t as i,ta as H,v as p,w as O}from"./chunk-RPINSWGJ.js";import"./chunk-LJ5XHLMQ.js";import{h as u}from"./chunk-FK42CRUA.js";var f=class o{constructor(n){this.httpClient=n}traerPreguntaTrivia(){return this.httpClient.get("https://opentdb.com/api.php?amount=1&type=multiple")}static \u0275fac=function(e){return new(e||o)(_(D))};static \u0275prov=P({token:o,factory:o.\u0275fac,providedIn:"root"})};var V=(o,n)=>({correcta:o,incorrecta:n});function $(o,n){if(o&1){let e=k();a(0,"div",9)(1,"button",10),g("click",function(){let r=C(e).$implicit,b=m();return M(b.responder(r))}),d(2),s()()}if(o&2){let e=n.$implicit,t=m();i(),l("disabled",t.seleccion()!==null)("ngClass",S(3,V,t.seleccion()&&e===t.correcta(),t.seleccion()&&e===t.seleccion()&&e!==t.correcta())),i(),v(" ",e," ")}}function L(o,n){if(o&1&&(a(0,"p",11),d(1),s()),o&2){let e=m();i(),x(e.resultado())}}var z=class o{constructor(n,e,t,r){this.database=n;this.authService=e;this.httpService=t;this.router=r}pregunta=c("");cargandoPregunta=c(!1);user;respuestas=c([]);correcta=c("");resultado=c("");seleccion=c(null);aciertos=c(0);errores=c(0);ngOnInit(){return u(this,null,function*(){let n=this.authService.user$.subscribe(t=>u(this,null,function*(){this.user=t,yield this.database.getPuntajePreguntados(this.user.id).then(r=>{r&&r.length>0&&(this.aciertos.set(r[0].aciertos),this.errores.set(r[0].errores))})})),e=this.user.id;e&&(yield this.database.iniciarNuevaPartidaPreguntados(e),this.cargarPregunta())})}ngOnDestroy(){return u(this,null,function*(){let n=this.user.id;n&&(yield this.database.finalizarPartidaPreguntados(n))})}cargarPregunta(){this.cargandoPregunta.set(!0),this.httpService.traerPreguntaTrivia().subscribe({next:n=>{if(n.results.length===0){this.resultado.set(" No se pudo obtener una pregunta."),this.cargandoPregunta.set(!1);return}let e=n.results[0],t=this.decodeHtml(e.question),r=this.decodeHtml(e.correct_answer),b=[e.correct_answer,...e.incorrect_answers].map(this.decodeHtml),F=this.shuffle(b);setTimeout(()=>{this.pregunta.set(t),this.correcta.set(r),this.respuestas.set(F),this.resultado.set(""),this.seleccion.set(null),this.cargandoPregunta.set(!1)},2500)},error:n=>{console.error("Error al traer la pregunta:",n),this.cargandoPregunta.set(!1)}})}responder(n){return u(this,null,function*(){this.seleccion.set(n);let e=n===this.correcta();console.log("Respuesta seleccionada:",n,"Correcta:",this.correcta(),"Es correcta:",e),console.log("User:",this.user),console.log("User nomrbre"+this.user.id),e?this.aciertos.update(r=>r+1):this.errores.update(r=>r+1);let t=this.user.id;console.log("Nombre usuario:",t),t&&(yield this.database.actualizarPreguntados(t,e))})}shuffle(n){return n.sort(()=>Math.random()-.5)}decodeHtml(n){let e=document.createElement("textarea");return e.innerHTML=n,e.value}siguientePregunta(){return u(this,null,function*(){if(!(this.seleccion()!==null)){this.errores.update(t=>t+1);let e=this.user.id;e&&(yield this.database.actualizarPreguntados(e,!1)),this.resultado.set(" No respondiste la pregunta.")}this.cargarPregunta()})}volver(){this.router.navigate(["/home"])}static \u0275fac=function(e){return new(e||o)(p(j),p(T),p(f),p(H))};static \u0275cmp=O({type:o,selectors:[["app-preguntados"]],decls:18,vars:7,consts:[["routerLink","/home","title","Volver al inicio",1,"volver-home-btn",3,"click"],[2,"font-size","1.5em","vertical-align","middle"],[1,"preguntados-container"],[1,"descripcion"],[1,"opciones-container"],["class","opcion",4,"ngFor","ngForOf"],["class","resultado-text",4,"ngIf"],[1,"siguiente-pregunta",3,"click","disabled"],[1,"marcador"],[1,"opcion"],[3,"click","disabled","ngClass"],[1,"resultado-text"]],template:function(e,t){e&1&&(a(0,"button",0),g("click",function(){return t.volver()}),a(1,"span",1),d(2,"\u2190"),s(),d(3," Home "),s(),a(4,"div",2)(5,"h1"),d(6,"Preguntados"),s(),a(7,"div",3)(8,"h2"),d(9),s()(),a(10,"div",4),h(11,$,3,6,"div",5),s(),h(12,L,2,1,"p",6),a(13,"button",7),g("click",function(){return t.siguientePregunta()}),d(14),s(),a(15,"div",8)(16,"p"),d(17),s()()()),e&2&&(i(9),x(t.pregunta()),i(2),l("ngForOf",t.respuestas()),i(),l("ngIf",t.resultado()),i(),l("disabled",t.cargandoPregunta()),i(),v(" ",t.cargandoPregunta()?"Cargando pregunta...":"Siguiente Pregunta"," "),i(3),w("\u2705 Aciertos: ",t.aciertos()," | \u274C Errores: ",t.errores()))},dependencies:[E,y,I,N],styles:[".preguntados-container[_ngcontent-%COMP%]{max-width:700px;margin:40px auto;padding:40px;background:#0009;border-radius:12px;box-shadow:0 0 20px #c93eff66;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);color:#fff;text-align:center}.volver-home-btn[_ngcontent-%COMP%]{position:absolute;top:24px;left:24px;display:flex;align-items:center;gap:6px;background:linear-gradient(90deg,#818cf8,#6366f1);color:#fff;font-weight:600;padding:8px 18px;border-radius:8px;text-decoration:none;box-shadow:0 2px 8px #6366f11a;transition:background .2s,transform .1s;z-index:10}.volver-home-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(90deg,#6366f1,#818cf8);transform:translateY(-2px) scale(1.03)}.btn[_ngcontent-%COMP%]:hover{transform:translate(.5em,-.5em);box-shadow:-1em 1em .15em #1018321a}.preguntados-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#c93eff;text-shadow:0 0 5px #c93eff;margin-bottom:15px}.preguntados-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#dd8fff;text-shadow:0 0 5px #c93eff;margin-bottom:15px}.descripcion[_ngcontent-%COMP%]{text-align:left;margin-bottom:20px}.opciones-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;max-width:500px;margin-inline:auto}.opciones-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#c93eff;color:#fff;padding:16px;font-size:16px;border:none;border-radius:10px;cursor:pointer;box-shadow:0 0 10px #c93eff80;transition:background .3s ease;width:100%;height:100%}.opciones-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#9e2bff}.opciones-container[_ngcontent-%COMP%]   button.seleccionada[_ngcontent-%COMP%]{background:#4a90e2}.opciones-container[_ngcontent-%COMP%]   button.correcta[_ngcontent-%COMP%]{background:#4caf50}.opciones-container[_ngcontent-%COMP%]   button.incorrecta[_ngcontent-%COMP%]{background:#f44336}.resultado-text[_ngcontent-%COMP%]{font-size:18px;font-weight:700;margin-top:10px}.resultado-text.correcta[_ngcontent-%COMP%]{color:#4caf50}.resultado-text.incorrecta[_ngcontent-%COMP%]{color:#f44336}.siguiente-pregunta[_ngcontent-%COMP%]{background:#4a90e2;color:#000;padding:12px 24px;border-radius:8px;cursor:pointer;box-shadow:0 0 10px #4a90e280;transition:background .3s ease;border:none}.siguiente-pregunta[_ngcontent-%COMP%]:hover{background:#357abd}.siguiente-pregunta[_ngcontent-%COMP%]:disabled{background:#9e9e9e;cursor:not-allowed}.marcador[_ngcontent-%COMP%]{font-size:18px;margin-top:20px;color:#fff}.marcador[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{background:#ffffff1a;padding:10px 20px;border-radius:8px;display:inline-block}"]})};export{z as PreguntadosComponent};
